<div class="space-y-6">
  <div class="bg-white rounded-lg shadow-sm p-6 border border-gray-200">
    <div class="flex items-center space-x-4">
      <button mat-icon-button (click)="onCancel()" class="text-gray-600">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <div>
        <nav class="text-sm text-gray-500 mb-1">
          <a (click)="onCancel()" class="hover:text-gray-700 cursor-pointer">Tasks</a>
          <span class="mx-2">/</span>
          <span class="text-gray-900">{{ isEditMode() ? 'Edit Task' : 'New Task' }}</span>
        </nav>
        <h1 class="text-2xl font-bold text-gray-900">
          {{ pageTitle() }}
        </h1>
      </div>
    </div>
  </div>

  @if (error()) {
    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
      <div class="flex items-center">
        <mat-icon class="text-red-500 mr-2">error</mat-icon>
        <p class="text-red-700">{{ error() }}</p>
      </div>
    </div>
  }

  @if (loading()) {
    <div class="flex justify-center items-center py-12">
      <mat-spinner diameter="40"></mat-spinner>
    </div>
  }

  @if (!loading()) {
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <div class="flex flex-col lg:flex-row gap-6 max-w-7xl mx-auto">
        <div class="lg:flex-1">
          <mat-card class="border border-gray-200 shadow-sm hover:shadow-md transition-shadow mb-6">
            <mat-card-header>
              <mat-card-title class="text-gray-900">Task Information</mat-card-title>
            </mat-card-header>

            <mat-card-content class="p-6">
              <div class="space-y-6">
                <div class="form-field-wrapper">
                  <mat-label for="title">Task Title</mat-label>
                  <mat-form-field class="w-full">
                    <input matInput formControlName="title" placeholder="Enter task title" />
                    @if (isFieldInvalid('title')) {
                      <mat-error>{{ getFieldError('title') }}</mat-error>
                    }
                  </mat-form-field>
                </div>

                <div class="form-field-wrapper">
                  <label>Description</label>
                  <mat-form-field class="w-full">
                    <textarea
                      matInput
                      formControlName="description"
                      rows="4"
                      placeholder="Describe what needs to be done"
                    ></textarea>
                  </mat-form-field>
                </div>

                <div class="form-field-wrapper">
                  <label>Project</label>
                  <mat-form-field class="w-full">
                    <mat-select formControlName="projectId">
                      @for (project of projects(); track project.id) {
                        <mat-option [value]="project.id">{{ project.name }}</mat-option>
                      }
                    </mat-select>
                    @if (isFieldInvalid('projectId')) {
                      <mat-error>{{ getFieldError('projectId') }}</mat-error>
                    }
                  </mat-form-field>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div class="form-field-wrapper">
                    <label>Status</label>
                    <mat-form-field class="w-full">
                      <mat-select formControlName="status">
                        @for (option of statusOptions; track option.value) {
                          <mat-option [value]="option.value">{{ option.label }}</mat-option>
                        }
                      </mat-select>
                    </mat-form-field>
                  </div>

                  <div class="form-field-wrapper">
                    <label>Priority</label>
                    <mat-form-field class="w-full">
                      <mat-select formControlName="priority">
                        @for (priority of priorityOptions; track priority.value) {
                          <mat-option [value]="priority.value">
                            <span [class]="priority.color">{{ priority.label }}</span>
                          </mat-option>
                        }
                      </mat-select>
                    </mat-form-field>
                  </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div class="form-field-wrapper">
                    <label>Assignee</label>
                    <mat-form-field class="w-full">
                      <mat-select formControlName="assigneeId">
                        <mat-option value="">Unassigned</mat-option>
                        @for (assignee of assignees(); track assignee.id) {
                          <mat-option [value]="assignee.id">{{ assignee.name }}</mat-option>
                        }
                      </mat-select>
                    </mat-form-field>
                  </div>

                  <div class="form-field-wrapper">
                    <label>Due Date</label>
                    <mat-form-field class="w-full">
                      <input matInput [matDatepicker]="picker" formControlName="dueDate" />
                      <mat-hint>Optional: Set a target completion date</mat-hint>
                      <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                      <mat-datepicker #picker></mat-datepicker>
                    </mat-form-field>
                  </div>
                </div>

                <div class="form-field-wrapper">
                  <label>Estimated Pomodoros</label>
                  <mat-form-field class="w-full">
                    <input
                      matInput
                      type="number"
                      formControlName="estimatedPomodoros"
                      placeholder="How many 25-minute sessions?"
                      min="1"
                      max="50"
                    />
                    <mat-hint>Each pomodoro = 25 minutes of focused work</mat-hint>
                    @if (isFieldInvalid('estimatedPomodoros')) {
                      <mat-error>{{ getFieldError('estimatedPomodoros') }}</mat-error>
                    }
                  </mat-form-field>
                </div>
              </div>
            </mat-card-content>
          </mat-card>

          <mat-card class="border border-gray-200 shadow-sm hover:shadow-md transition-shadow">
            <mat-card-header>
              <mat-card-title class="text-gray-900">Tags</mat-card-title>
              <mat-card-subtitle class="text-gray-600">Add tags to categorize your task</mat-card-subtitle>
            </mat-card-header>

            <mat-card-content class="p-6">
              <mat-form-field class="w-full">
                <mat-label>Add Tags</mat-label>
                <mat-chip-grid #chipGrid aria-label="Task tags">
                  @for (tag of tags(); track tag) {
                    <mat-chip-row (removed)="removeTag(tag)">
                      {{ tag }}
                      <button matChipRemove [attr.aria-label]="'Remove ' + tag">
                        <mat-icon>cancel</mat-icon>
                      </button>
                    </mat-chip-row>
                  }
                </mat-chip-grid>
                <input
                  placeholder="Enter tag and press Enter..."
                  [matChipInputFor]="chipGrid"
                  [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                  (matChipInputTokenEnd)="addTag($event)"
                />
                <mat-hint>Press Enter or comma to add a tag</mat-hint>
              </mat-form-field>
            </mat-card-content>
          </mat-card>
        </div>

        <div class="lg:w-80 space-y-6">
          <mat-card class="border border-gray-200 shadow-sm">
            <mat-card-content class="p-6">
              <div class="space-y-4">
                <button
                  type="submit"
                  mat-raised-button
                  color="primary"
                  class="w-full h-12"
                  [disabled]="form.invalid || saving()"
                >
                  @if (saving()) {
                    <mat-spinner diameter="20" class="mr-2"></mat-spinner>
                  }
                  <mat-icon class="mr-2">{{ isEditMode() ? 'save' : 'add' }}</mat-icon>
                  {{ submitButtonText() }}
                </button>

                <button
                  type="button"
                  mat-stroked-button
                  color="primary"
                  class="w-full h-12"
                  (click)="onCancel()"
                  [disabled]="saving()"
                >
                  <mat-icon class="mr-2">cancel</mat-icon>
                  Cancel
                </button>

                <button
                  type="button"
                  mat-stroked-button
                  class="w-full h-12"
                  (click)="onReset()"
                  [disabled]="saving()"
                >
                  <mat-icon class="mr-2">refresh</mat-icon>
                  Reset Form
                </button>
              </div>
            </mat-card-content>
          </mat-card>

          <mat-card class="border border-gray-200 shadow-sm">
            <mat-card-header>
              <mat-card-title class="flex items-center text-gray-900">
                <mat-icon class="mr-2 text-blue-500">help_outline</mat-icon>
                Tips
              </mat-card-title>
            </mat-card-header>

            <mat-card-content class="p-6">
              <div class="text-sm text-gray-600 space-y-2">
                <p>• Write a clear, specific task title</p>
                <p>• Add relevant tags to organize your work</p>
                <p>• Set realistic time estimates with pomodoros</p>
                <p>• Assign due dates to track deadlines</p>
                <p>• Use priority levels to focus on important tasks</p>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </div>
    </form>
  }
</div>
